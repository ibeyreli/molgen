# molgen
Deep Molecule Generation

** The more detailed report: [Challenges in Computer Aided Drug Design with GenerativeAdversarial Networks](https://github.com/ibeyreli/molgen/blob/main/challenges_in_CADD_with_GANs_by_ilayda_beyreli_kokundu.pdf).**

Drug design can be defined as creating new organic molecules that interact with bio-molecules such as proteins in certain ways to affect their function in the biological system. It mainly involves designing molecules that possess certain physical and the chemical properties. In the case of computer aided drug design, we may illustrate molecules as graphs where  the atoms are nodes and the chemical bonds among them are edges. With such an analogy, deep generative networks (DGNs) show the potential of being strong tools for drug and molecule design. Although one needs to make use of a number heuristics to convert the traditional models that generate grid structured data, such as images, recent researches focuses more on drug design with generative models.In this project, we aim to apply an approach to implement a deep generative model to predict best planar molecule structure where the number of atoms per element and some desired properties are given as the input. This report contains the brief information about the selected data set,  methods and experiments.

In this project, the planar structure of a compound will be presented as a graph consisting of a single connected component. To obtain standard output at the end of the network, the adjacency matrix of this matrix will be assumed to have a constant number of nodes. Hence, for different compounds with different number of atoms, the size of the single connected component will change while the total number of nodes will be preserved with disconnected vertices. Due to the varying maximum number of bonds that each type of atom can make, some restrictions will be enforced on the adjacency matrix.

### Dataset
ChEMBL is a database for small bio-active molecules curated from scientific literature. It contains 2D structures and properties of more than 2 million drug-like molecules. The aim is to use the properties of these compounds to generate their 2D structures correctly.

The closed formula of the molecules and their SMILES notations are obtained from this dataset. After finding the highest number of atoms from each element using closed formulas, fixed sized adjacency matrices, $A$s, are generated in such a way that if element $i$ and element $j$ bonds in molecule $m$, then ${}^{m}A_{ij} = {}^{m}A_{ji} = 1$ and else ${}^{m}A_{ij} = {}^{m}A_{ji} = 0$ where ${}^{m}A$ is the adjacency matrix for molecule $m$. The bond information to generate such matrices is obtained from the SMILES notation. The redundant elements for each molecule are left disconnected in the adjacency matrix. 

For the feature vector $x$, the number of atoms for five core elements of hydrocarbons, carbon (C), oxygen (O), hydrogen (H), nitrogen (N), and fluoride (F), are obtained. For molecule $m$, ${}^{m}x$ contains the number of C, O, H, N, and F atoms in the molecule. While this is not the most practical setup, it is believed to be the most basic feature vector to be fed to the network in the initial phase to analyze how the generative network works and what it learns.

### Method

MolGen is a multilayer perceptron (MLP) based generative adversarial network which takes desired features for the molecule and the number of atoms for each element and generates an adjacency matrix representing the planar structure of the molecule. The model consists of 3 modules: the module that generates conditional code, the generator, and the discriminator. In the simplest case, the conditional code module (CCM) applies identity transform. However, it is also possible to learn a particular embedding. The generator and the discriminator are three-layer MLP-based modules, where batch normalization and Leaky RelU activation function with a negative sloped of $m=0.2$ is applied after each linear hidden layer. Also, dropout with probability $p=0.4$ is used for the discriminator.

MolGen uses mean square error for the discriminator loss. The generative loss consists of three terms: the adversarial loss $L_{adv}$,  the symmetry loss $L_{sym}$, and the bond loss $L_{bond}$. The adversarial loss is similar to the discriminator loss, where the mean square error between the output of the discriminator for the subject image and $1.0$, which is the label for real molecules. The symmetry and bond losses incorporate the domain knowledge into the training process. $L_{sym}$ ensures the generated matrices are symmetric, i.e., the generated molecule graphs are un-directed. To achieve this, the generated matrix, ${}^{g}A$ is subtracted from its transpose. If the adjacency matrix of $m$ is symmetric, then ${}^{m}A_{ij} = {}^{m}A^T_{ij}$ for all $i$ and $j$, and $L_{sym}(m) = 0$.

From chemistry, it is fundamentally known that each atom has a fixed number of valence electrons, i.e., the maximum number of bonds it can make is predefined. For example, a carbon atom in the molecule should not be allowed to have more than four bonds with different atoms, as it has four electrons in its valence band. Therefore, a reference vector, $v$, that represents the number of bonds each atom can make is used such that $v_i = 1/ (\textrm{total number of bonds atom } i \textrm{ can make})$. Note that all adjacency matrices in the dataset are prepossessed so that the same row corresponds to the same element for all, and $v$ does not change.
